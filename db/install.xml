<?xml version="1.0" encoding="UTF-8"?>
<XMLDB PATH="mod/vmrequest/db" VERSION="2025080100" COMMENT="XMLDB file for VM Request plugin"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd">
  <TABLES>

    <!-- 1) Modul-Instanz-Tabelle: Standard-Felder + keine Antragsdaten mehr -->
    <TABLE NAME="vmrequest" COMMENT="VM Request activity settings">
      <FIELDS>
      <FIELD NAME="id"           TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
      <FIELD NAME="course"       TYPE="int"    LENGTH="10" NOTNULL="true"/>
      <FIELD NAME="name"         TYPE="char"   LENGTH="255" NOTNULL="true"/>
      <FIELD NAME="is_general_supervision" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0"/>
      <FIELD NAME="config_studentrequests" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1"/>
      <FIELD NAME="intro"        TYPE="text"   NOTNULL="false" SEQUENCE="false"/>
      <FIELD NAME="introformat"  TYPE="int"    LENGTH="4"  NOTNULL="true" DEFAULT="0"/>
      <FIELD NAME="timecreated"  TYPE="int"    LENGTH="10" NOTNULL="true"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
    </TABLE>

    <!-- 2) Neue Tabelle für VM-Anträge -->
    <TABLE NAME="vmrequest_request" COMMENT="Tabelle für VM-Anträge">
      <FIELDS>
        <FIELD NAME="id"            TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="coursemodule"  TYPE="int"    LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="userid"        TYPE="int"    LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="submitter"     TYPE="int"    LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="course_request_id"        TYPE="int"    LENGTH="10" NOTNULL="false"/>
        <FIELD NAME="vmname"        TYPE="char"   LENGTH="100" NOTNULL="true"/>
        <FIELD NAME="vmsize"        TYPE="char"   LENGTH="50"  NOTNULL="true"/>
        <FIELD NAME="vmos"          TYPE="char"   LENGTH="50"  NOTNULL="true"/>
        <FIELD NAME="justification" TYPE="text"   NOTNULL="false"/>
        <FIELD NAME="status"        TYPE="char"   LENGTH="50"  NOTNULL="true" DEFAULT="beantragt"/>
        <FIELD NAME="denialreason"  TYPE="text"   NOTNULL="false"/>
        <FIELD NAME="timecreated"   TYPE="int"    LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="supervisorid" TYPE="int" LENGTH="10" NOTNULL="false" DEFAULT="0" COMMENT="ID des genehmigenden Betreuers"/>
        <FIELD NAME="instanceid" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Referenz auf erzeugte VM-Instanz"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="cm_user" FIELDS="coursemodule,userid" UNIQUE="false"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="vmrequest_course_request" COMMENT="Kursweite VM-Anträge">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="coursemodule" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="false"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="vmname" TYPE="char" LENGTH="255" NOTNULL="true"/>
        <FIELD NAME="vmsize" TYPE="char" LENGTH="50" NOTNULL="true"/>
        <FIELD NAME="vmos" TYPE="char" LENGTH="50" NOTNULL="true"/>
        <FIELD NAME="justification" TYPE="text" NOTNULL="false"/>
        <FIELD NAME="status" TYPE="char" LENGTH="50" NOTNULL="true"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="selectedcount" TYPE="int" LENGTH="10" NOTNULL="true"/>
      </FIELDS>
      <KEYS>
          <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
    </TABLE>

    <TABLE NAME="vmrequest_course_request_users" COMMENT="Zugewiesene Nutzer zu Kursantrag">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="requestid" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="requestfk" TYPE="foreign" FIELDS="requestid" REFTABLE="vmrequest_course_request" REFFIELDS="id"/>
        <KEY NAME="userfk" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
    </TABLE>

    <TABLE NAME="vmrequest_instance" COMMENT="Erzeugte VM-Instanzen (zugeordnet zu einem oder mehreren Anträgen)">
      <FIELDS>
        <FIELD NAME="id"             TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="uuid"           TYPE="char"   LENGTH="100" NOTNULL="true" COMMENT="OpenStack- oder interne VM-ID"/>
        <FIELD NAME="vmname"         TYPE="char"   LENGTH="100" NOTNULL="true"/>
        <FIELD NAME="vmsize"         TYPE="char"   LENGTH="50"  NOTNULL="true"/>
        <FIELD NAME="vmos"           TYPE="char"   LENGTH="50"  NOTNULL="false"/>
        <FIELD NAME="ip_address"     TYPE="char"   LENGTH="100" NOTNULL="false"/>
        <FIELD NAME="status"         TYPE="char"   LENGTH="50"  NOTNULL="true" DEFAULT="provisioning"/>
        <FIELD NAME="guac_client_id" TYPE="char"   LENGTH="100" NOTNULL="false" COMMENT="Guacamole client ID"/>
        <FIELD NAME="useremail"      TYPE="char" LENGTH="255" NOTNULL="true" DEFAULT=""/>
        <FIELD NAME="timecreated"    TYPE="int"    LENGTH="10"  NOTNULL="true"/>
        <FIELD NAME="lastupdated"    TYPE="int"    LENGTH="10"  NOTNULL="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
    </TABLE>
  </TABLES>
</XMLDB>
